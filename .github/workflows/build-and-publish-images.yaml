name: Build Rocky Linux 9 container image

on:
  push:
    branches:
      - main
      - refactoring

jobs:
  buildkit:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'buildkit'
      image_tag: 'latest'
      containerfile: 'buildkit/Containerfile'
      platforms: 'linux/amd64,linux/arm64'

  rocky-linux-9-minimal:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: buildkit
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'rockylinux'
      image_tag: '9-minimal'
      containerfile: 'rocky-linux/Containerfile'
      build_args: 'BASE_IMAGE=cr.spk.no/docker-hub/rockylinux:9-minimal'
      platforms: 'linux/amd64,linux/arm64'

  zulu-openjdk-21-jdk:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: rocky-linux-9-minimal
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'zulu-openjdk'
      image_tag: '21-jdk'
      containerfile: 'zulu-openjdk/Containerfile'
      build_args: 'BASE_IMAGE=ghcr.io/statens-pensjonskasse/rockylinux:9-minimal, JAVA_VERSION=21, JAVA_TYPE=jdk'
      platforms: 'linux/amd64'

  zulu-openjdk-21-jre:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: rocky-linux-9-minimal
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'zulu-openjdk'
      image_tag: '21-jre'
      containerfile: 'zulu-openjdk/Containerfile'
      build_args: 'BASE_IMAGE=ghcr.io/statens-pensjonskasse/rockylinux:9-minimal, JAVA_VERSION=21, JAVA_TYPE=jre'
      platforms: 'linux/amd64'

  maven-3-9-9-zulu-openjdk-21:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: zulu-openjdk-21-jdk
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'maven'
      image_tag: '3.9.9-zulu-openjdk-21'
      containerfile: 'maven/Containerfile'
      build_args: 'BASE_IMAGE=ghcr.io/statens-pensjonskasse/zulu-openjdk:21-jdk, MAVEN_VERSION=3.9.9'
      platforms: 'linux/amd64'

name: Build Rocky Linux 9 container image

on:
  push:
    branches:
      - main
      - build_image
  pull_request:
    branches:
      - main

jobs:
  build-buildkit:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'buildkit'
      image_tag: 'latest'
      containerfile: 'buildkit/Containerfile'
      platforms: 'linux/amd64'

  build-rocky-linux-9-minimal:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: build-buildkit
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'rockylinux'
      image_tag: '9-minimal'
      containerfile: 'os/Containerfile'
      build_arg_file: 'os/rocky-linux-9-minimal.conf'
      platforms: 'linux/amd64'

  build-zulu-openjdk-21-jdk:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: build-rocky-linux-9-minimal
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'zulu-openjdk'
      image_tag: '21-jdk'
      containerfile: 'zulu-openjdk/Containerfile'
      build_arg_file: 'zulu-openjdk/zulu-openjdk-21-jdk.conf'
      platforms: 'linux/amd64'

  build-zulu-openjdk-21-jre:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: build-rocky-linux-9-minimal
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'zulu-openjdk'
      image_tag: '21-jre'
      containerfile: 'zulu-openjdk/Containerfile'
      build_arg_file: 'zulu-openjdk/zulu-openjdk-21-jre.conf'
      platforms: 'linux/amd64'

  build-maven-3-9-9-zulu-openjdk-21:
    uses: ./.github/workflows/podman-build-and-publish.yaml
    needs: build-zulu-openjdk-21-jdk
    secrets: inherit
    permissions:
      contents: read
      packages: write
    with:
      image_name: 'maven'
      image_tag: '3.9.9-zulu-openjdk-21'
      containerfile: 'maven/Containerfile'
      build_arg_file: 'maven/maven-3.9.9-zulu-openjdk-21.conf'
      platforms: 'linux/amd64'
